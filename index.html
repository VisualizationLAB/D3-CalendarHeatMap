<!DOCTYPE html>
<meta charset="utf-8">
<style>

body {
  font: 10px sans-serif;
  shape-rendering: crispEdges;
}

.day {
  //fill: #fff;
  fill:rgba(179,179,179,0.2);
  //stroke: #ccc;
  stroke: #fff;
  stroke-width: 1px;
}


.month {
  fill: none;
  //stroke: #000;
  stroke: #fff;
  stroke-width: 4px;
  
  font: 10px sans-serif;
}
.H1 {
   font-size: 15px;
   padding: 10px;
  // color: rgba(102, 102, 102,1); 
  color: rgba(51, 102, 153,.5);
   TEXT-ALIGN: CENTER;
    font-weight:bold;
}
#summ_row1 {
  //color: rgba(153, 153, 153,.7);
  color: rgba(51, 102, 153,1);
  stroke: red;
  font-size:11px;
  //font-weight:bold;
}
.sub_title{
  //color: rgba(153, 153, 153,.7);
  color: rgba(51, 102, 153,1);
  stroke: red;
  font-size:14px;
  font-weight:bold;
}
.sub_titleL{
  //color: rgba(153, 153, 153,.7);
  color: rgba(179,179,179,0.7);
  stroke: red;
  font-size:14px;
  font-weight:bold;
}
#summ_row2 {
  //color: rgba(51, 102, 153,.7);
  color: rgba(51, 102, 153,1);
  stroke: red;
  font-size:20px;
}
.summ_row4 {
  //color: rgba(51, 102, 153,.7);
  color: rgba(51, 102, 153,1);
  stroke: red;
  font-size:20px;
}

#summ_Line {
	cellpadding: 10px;
	font-size:20px;
}
table.control_2:hover {
  fill: red;
}

.control_1_2 { 
cell-padding: 10;
}

#currDate{
  //color: rgba(51, 102, 153,.7);
  color: rgba(51, 102, 153,1);
  font-size:40px;
}

.C4{
   height: 250px;
   //border: 2px solid #F00;
   border: none;
   width: 1000px;
    //padding: 3px;
    overflow: auto;

    /* POSITION */
    position:fixed;
}



.q10-11{fill:rgba(0,104,55,1)}
.q9-11{fill:rgba(0,104,55,.9)}
.q8-11{fill:rgba(0,104,55,.8)}
.q7-11{fill:rgba(0,104,55,.7)}
.q6-11{fill:rgba(0,104,55,.6)}
.q5-11{fill:rgba(0,104,55,.5)}

.q4-11{fill:rgba(0,104,55,.4)}
.q3-11{fill:rgba(0,104,55,.3)}
.q2-11{fill:rgba(0,104,55,.2)}
.q1-11{fill:rgba(0,104,55,.1)}
.q0-11{fill:rgba(0,104,55,.075)}
.Nq0-11{fill:rgba(255,255,0,.2)}


.qE10-11{fill:rgba(165,0,38,1)}
.qE9-11{fill:rgba(165,0,38,.9)}
.qE8-11{fill:rgba(165,0,38,.8)}
.qE7-11{fill:rgba(165,0,38,.7)}
.qE6-11{fill:rgba(165,0,38,.6)}
.qE5-11{fill:rgba(165,0,38,.5)}

.qE4-11{fill:rgba(165,0,38,.4)}
.qE3-11{fill:rgba(165,0,38,.3)}
.qE2-11{fill:rgba(165,0,38,.2)}
.qE1-11{fill:rgba(165,0,38,.1)}
.qE0-11{fill:rgba(165,0,38,.075)}
.NqE0-11{fill:rgba(0,104,55,.3)}

</style>
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/queue.v1.min.js"></script>
<!--link rel="stylesheet" href="http://code.jquery.com/ui/1.9.0/themes/base/jquery-ui.css" /-->
<!--script src="http://code.jquery.com/jquery-1.8.2.js"></script-->
<!--script src="http://code.jquery.com/ui/1.9.0/jquery-ui.js"></script-->
<!--link rel="stylesheet" href="style.css" /-->
<script>

	
var width = 960,
    height = 150,
    cellSize = 17; // cell size

var dataOriginal;
var arrayRange = 12;
var domainMax = 20000000;
var domainMin = 0;
//Controls
var select_1 = "err";
var strSelectID = "TOTAL LOADED RECORDS";
var select_Class = "";
var BIGDATA = [];
var selectedDate = ""
var selectedDateLast = ""

var SummaryData = [];
var SelectedData = [];

var day = d3.time.format("%w"),
    week = d3.time.format("%U"),
    percent = d3.format(".1%"),
    format = d3.time.format("%Y-%m-%d");
	//format2 = d3.time.format("%a-%b-%e-%d");



var mainTable = d3.select("body")
		.attr("onload", "loadData()")
		.append("table")
		.attr("class" , "main")
		.attr("id" , "main")
		.attr("border", 0)
		.attr("cellpadding", 15)
		.attr("width", "100%")
		.attr("height", "100%");
		
mainTable.append("tr")
	.attr("class" , "H1")
	.append("td")
	.attr("align", "center")
	.attr("colspan", 3)
	.text( function(d) {return "JIVA DATA LOAD REPORT ANALYTICS" });

mainTable.append("tr")
	.attr("class", "details")
	.append("td")
	.attr("id", "currDate")
	.attr("align", "center")
	.attr("valign", "top")
	.text( function(d) {
		//var format2 = d3.time.format("%a");
		//var newStrdate = format2.parse(Date());
		//var newStrdate = Date().substring(0,15);
		var d2 = new Date();
		newStrdate = buildDataview (d2,"");
		//console.log("newStrdate")
		//console.log(Date().substring(0,15))
		//console.log(newStrdate)
		
		selectedDate = newStrdate;
		newStrdateX = buildDisplayDate(selectedDate);
		return newStrdateX;
		});
	
mainTable.append("tr")
	.attr("class", "control_1");
	
mainTable.append("tr")
	.append("td")
	.attr("align", "center")
	.append("table")
	//.attr("width", "100%")
	.append("tr")
	.attr("class", "detailsR");
	//.append("td");
	//.text( function(d) {return "JIVA DATA LOAD REPORT ANALYTICS" });

d3.select(".detailsR").append("td")
	.attr("class","sub_titleL")
	.attr("id","sub_titleL")
	.attr("align", "right")
	.text("CALENDAR HEAT MAP FOR");
	
d3.select(".detailsR").append("td")
	.attr("class","sub_title")
	.attr("id","sub_title")
	.attr("align", "left")
	.text(strSelectID);
	
mainTable.append("tr")
	.attr("class", "legendCR");

/*mainTable.append("tr")
	.attr("class", "details")
	.append("td");
	//.text( function(d) {return "JIVA DATA LOAD REPORT ANALYTICS" });*/

mainTable.append("tr")
	.attr("class", "details")
	.append("td")
	.attr("class","sub_titleL")
	.attr("id","sub_titleL")
	.attr("align", "center")
	.text( function(d) {return "SUMMARY" });
	
mainTable.append("tr")
	.attr("class", "control_2");

//--Summary Section row 1 --//
	
d3.select(".control_1").append("td")
	.attr("width", "100%")
	.attr("align", "center")
	.append("table")
	.attr("class", "summary")
	.attr("width", "100%")
	.attr("border", 0)
	.attr("cellpadding", 5)
	.append("tr")
	.attr("class","summ_row1")
	.attr("id","summ_row1")
	.attr("align","center");
	/*.append("td")
	.attr("align", "left")
	.text("DATE")*/
	
///--mouseover /out functions ----//
function mouseOver(Ind) {
			select_1 = Ind;
			var newSelecteddate = selectedDate;
			console.log("selectedDate -> " + selectedDate + "| newSelecteddate ->" + newSelecteddate);
			console.log("document.getElementById(select_1).value");
			console.log(document.getElementById(select_1).textContent);
			var textVal = document.getElementById(select_1).textContent;
			strSelectID  = textVal;
			d3.select("#sub_title").text(textVal);
			
			//var d = new Date();
			//selectedDate = buildDataview (d, "");
			//buildSelectData(selectedDate, "");
			console.log("selectedDateLastHERE:" + selectedDateLast);
			document.getElementById(selectedDateLast).focus();
			d3.selectAll("svg").remove();
			console.log(select_1)
			drawCalender(select_1);
			
			
			
}
///--mouseover /out functions END----//

d3.select(".summ_row1").append("td")
	.attr("align", "right")
	.attr("id", "upd")
	.text("UPDATED RECORDS")
	.on("mouseover", function(d) {mouseOver (this.id); return;})

d3.select(".summ_row1").append("td")
	.attr("align", "right")
	.attr("id", "new")
	.text("INSERTED RECORDS")
	.on("mouseover", function(d) {mouseOver (this.id); return;})
	
d3.select(".summ_row1").append("td")
	.attr("align", "right")
	.attr("id", "tot")
	.text("TOTAL LOADED RECORDS")
	.on("mouseover", function(d) {mouseOver (this.id); return;})
	  
d3.select(".summ_row1").append("td")
	.attr("align", "left")
	.attr("id", "err")
	.text("FAILED RECORDS")
	.attr("style", "color:red;")
	.on("mouseover", function(d) {mouseOver (this.id); return;})
	  
d3.select(".summ_row1").append("td")
	.attr("align", "left")
	.attr("id", "durH")
	.text("LOAD TIME (Hrs)")
	.on("mouseover", function(d) {mouseOver (this.id); return;})
d3.select(".summ_row1").append("td")
	.attr("align", "left")
	.text("FILE TYPES")
d3.select(".summ_row1").append("td")
	.attr("align", "left")
	.attr("style", "color:red;")
	.text("ERROR TYPES")
	
//--Summary Section row 2 --//
d3.select(".summary").append("tr")
	.attr("class","summ_row2")
	.attr("id","summ_row2")
	.attr("align","center");
	/*.append("td")
	.attr("align", "left")
	.text("NA")*/
d3.select(".summ_row2").append("td")
	.attr("align", "right")
	.attr("id","dupd")
	.text("NA")
	
d3.select(".summ_row2").append("td")
	.attr("align", "right")
	.attr("id","dnew")
	.text("NA")
	
d3.select(".summ_row2").append("td")
	.attr("align", "right")
	.attr("id","dtot")
	.text("NA")
d3.select(".summ_row2").append("td")
	.attr("align", "left")
	.attr("id","derr")
	.attr("style", "color:red;")
	.text("NA")

d3.select(".summ_row2").append("td")
	.attr("align", "left")
	.attr("id","ddurH")
	.text("NA")
d3.select(".summ_row2").append("td")
	.attr("align", "left")
	.attr("id","dfile")
	.text("NA")
d3.select(".summ_row2").append("td")
	.attr("align", "left")
	.attr("id","derrM")
	.attr("style", "color:red;")
	.text("NA")
//--SUMARY - WHITE LINE --//
/*d3.select(".summary").append("tr")
	.attr("class","summ_Line")
	.attr("id","summ_Line")
	.attr("align","center")
	.append("td")
	.attr("align", "left")
	.text("SUMMARY")*/
	
// ---SUMARY SECTION - ROW 3 and 4
d3.select(".control_2").append("td")
	.attr("width", "100%")
	.attr("align", "center")
	.append("table")
	.attr("class", "summaryB")
	.attr("width", "100%")
	.attr("border", 0)
	.attr("cellpadding", 5)
	.append("tr")
	.attr("class","summ_row3")
	.attr("id","summ_row1")
	.attr("align","center");
d3.select(".summ_row3").append("td")
	.attr("align", "left")
	.attr("id", "Snew")
	.text("INSERTED RECORDS")
	//.on("mouseover", function(d) {mouseOver (this.id); return;})
d3.select(".summ_row3").append("td")
	.attr("align", "left")
	.attr("id", "Supd")
	.text("UPDATED RECORDS");
d3.select(".summ_row3").append("td")
	.attr("align", "left")
	.text("TOTAL DAYS");
	/*.append("td")
	.attr("align", "left")
	.text("DATE")*/
	
d3.select(".summ_row3").append("td")
	.attr("align", "left")
	.attr("id", "Stot")
	.attr("align", "right")
	.text("TOTAL LOADED RECORDS")
	//.on("mouseover", function(d) {mouseOver (this.id); return;})
	  
d3.select(".summ_row3").append("td")
	.attr("align", "left")
	.attr("id", "Serr")
	.attr("style", "color:red;")
	.text("FAILED RECORDS")
	//.on("mouseover", function(d) {mouseOver (this.id); return;})
	  

	//.on("mouseover", function(d) {mouseOver (this.id); return;})
d3.select(".summ_row3").append("td")
	.attr("align", "left")
	.attr("id", "SdurH")
	.text("LOAD TIME (Hrs)")
	//.on("mouseover", function(d) {mouseOver (this.id); return;})
d3.select(".summ_row3").append("td")
	.attr("align", "left")
	.text("FILE TYPES")

d3.select(".summ_row3").append("td")
	.attr("align", "right")
	.attr("style", "color:red;")
	.text("TOTAL ERROR DAYS")
	
d3.select(".summ_row3").append("td")
	.attr("align", "left")
	.attr("style", "color:red;")
	.text("ERROR TYPES")

	
//--Summary Section row 2 --//
d3.select(".summaryB").append("tr")
	.attr("class","summ_row4")
	.attr("align","center");
	/*.append("td")
	.attr("align", "left")
	.text("NA")*/
d3.select(".summ_row4").append("td")
	.attr("align", "left")
	.attr("id","Sdupd")
	.text("NA")
	
d3.select(".summ_row4").append("td")
	.attr("align", "left")
	.attr("id","Sdnew")
	.text("NA")
d3.select(".summ_row4").append("td")
	.attr("align", "left")
	.attr("id","SdDAYS")
	.text("NA")
d3.select(".summ_row4").append("td")
	.attr("align", "right")
	.attr("id","Sdtot")
	.text("NA")
d3.select(".summ_row4").append("td")
	.attr("align", "left")
	.attr("id","Sderr")
	.attr("style", "color:red;")
	.text("NA")
d3.select(".summ_row4").append("td")
	.attr("align", "left")
	.attr("id","SddurH")
	.text("NA")
d3.select(".summ_row4").append("td")
	.attr("align", "left")
	.attr("id","Sdfile")
	.text("NA")
d3.select(".summ_row4").append("td")
	.attr("align", "right")
	.attr("id","SderrDAYS")
	.attr("style", "color:red;")
	.text("NA")
d3.select(".summ_row4").append("td")
	.attr("align", "left")
	.attr("id","SderrM")
	.attr("style", "color:red;")
	.text("NA")
	
//--Summary Section END --//	
	
d3.select(".row2")
	.append("td")
	.attr("width", 500)
	.attr("id", "year")
	.attr("align", "left")
	.append("div")
	.attr("id", "slider-range")
	.attr("style", "display:none;")
	.on( "click", function(d) { 
		//console.log(this.value)
		});


	
// ++++++++ Calendar section
d3.select(".legendCR")
	.append("table")
	.append("tr")
	.attr("class", "C3")
	.append("td")
	.attr("class", "legendC")
	.attr("align", "center");
	//.attr("width", "100%");
	
d3.select(".C3")
	.append("td")
	.attr("class", "C4")
	.attr("valign" , "top");
// ++++++++ Calendar section END

/*$(function() {
    $( "#slider-range" ).slider({
    range: true,
    min: 0,
	max: 1000,
	values: [2012,2013],
    slide: function( event, ui ) {
    var maxv = d3.min([ui.values[1], 10]);
    var minv = d3.max([ui.values[0], 0]);
    }});
    });
*/
function loadData () {

 queue()
	.defer(d3.csv, "Calendar.csv")
	.await(ready);
}
var arrDates = [];
var arrFail = [];
var arrVol = [];
var arrNew = [];
var arrUpd = [];
var arrDurHrs = [];
var arrFileLayout = [];
var arrErrMsgs = [];
var objData = [];

function ready(error, dataCsv) {
console.log("dataCsv");
console.log(dataCsv);	
dataOriginal = dataCsv;

dataOriginal.forEach(function(d){ 
		console.log(d.Date);
		arrDates.push(d.Date);
		arrFail.push(parseInt(d.Tot_Failures));
		arrVol.push(parseInt(d.Tot_Records));
		arrNew.push(parseInt(d.Tot_Inserts));
		arrUpd.push(parseInt(d.Tot_Updates));
		arrDurHrs.push(d3.round(Number(d.Tot_Duration_Hrs),2));
		arrFileLayout.push(d.File_Layouts);
		arrErrMsgs.push(d.Error_Msgs);
		var datarow = {
						"Date" : d.Date,
						"Tot_Records" :  parseInt(d.Tot_Records),
						"Tot_Inserts" : parseInt(d.Tot_Inserts),
						"Tot_Updates" : parseInt(d.Tot_Updates),
						"Tot_Failures" : parseInt(d.Tot_Failures),
						"Tot_Duration_Secs" : d3.round(Number(d.Tot_Duration_Secs),2),
						"Tot_Duration_Hrs" : d3.round(Number(d.Tot_Duration_Hrs),2),
						"File_Layouts" : d.File_Layouts,
						"Error_Msgs" : d.Error_Msgs
						};
		BIGDATA.push(datarow);
		//console.log("d.Tot_Failures");
		//console.log(d.Tot_Failures);
		//console.log(arrFail);
		})
//console.log("BIGDATA");
//console.log(BIGDATA);
buildSummaryData ();
drawCalender(select_1);
//console.log("onload() : " + selectedDate);

var d = new Date();
selectedDate = buildDataview (d, "");
var selectedDateD = buildDisplayDate (selectedDate);
console.log(selectedDate)
selectedDateLast = selectedDate;
document.getElementById(selectedDate).focus();
buildSelectData(selectedDate, "");
/*console.log("document.getElementById(selectedDate).class")
var selectedClass = document.getElementById(selectedDate).className.baseVal;
if (selectedClass == "day") 
	{
	console.log(d3.select(selectedClass));
	//d3.select(selectedClass).style("stroke:red");
	}*/
}


	
//console.log("OUTSIDE")
//console.log(BIGDATA);
//console.log(dataOriginal);	
//console.log(arrFail);
//console.log(arrVol);	

function getDomainMax(val) {
switch (val)
{
case "tot":
  domainMax = d3.max(arrVol)
  break;
case "err":
  domainMax = d3.max(arrFail)
  break;
case "new":
  domainMax = d3.max(arrNew)
  break;
case "upd":
  domainMax = d3.max(arrUpd)
  break;
case "durH":
  domainMax = d3.max(arrDurHrs)
  break;
}
//return domainMax;
}

function getData(val,opt1,opt2,opt3,opt4,opt5) {
switch (val)
{
case "tot":
  vData = opt1
  break;
case "err":
  vData = opt2
  break;
case "new":
  vData = opt3
  break;
case "upd":
  vData = opt4
  break;
case "durH":
  vData = opt5
  break;
}
return vData;
}

// -- calendar building starts --//
function drawCalender(ind) {

//console.log("BIGDATA-drawCalender");
//console.log(BIGDATA);


var d = new Date();
//buildDataview (d, "");
console.log("drawCalender");
console.log(selectedDate);
var dataBIG = d3.nest()
			.key(function(d) { return d.Date; })
			.rollup(function(d) { //console.log(select_1); 
									var dataVal = getData(select_1,parseInt(d[0].Tot_Records),parseInt(d[0].Tot_Failures),parseInt(d[0].Tot_Inserts),parseInt(d[0].Tot_Updates),Number(d[0].Tot_Duration_Hrs));
									return dataVal;
								})
			.map(BIGDATA);
console.log("dataBIG-drawCalender");
console.log(dataBIG);			

getDomainMax(select_1,"domainMax");

	console.log("domainMax");
	console.log(domainMax);
	console.log(select_1);
	
var color = d3.scale.quantize()
   .domain([domainMin,domainMax])
    .range(d3.range(arrayRange-1).map(function(d) { 
							var strVal = "";
							if (select_1 == "err" || select_1 == "durH" ) 
							{ 
								strVal = "qE" + d + "-11";
							}
							else 
							{
								strVal = "q" + d + "-11";
							
							}
							//console.log(strVal);
							return strVal; 
							}
							
							));


console.log(color.domain());
var svg = d3.select(".C4").selectAll("svg")
	.data(d3.range(2013, 2014))
  .enter().append("svg")
    .attr("width", width)
    .attr("height", height)
    .attr("class", "RdYlGn")
  .append("g")
    .attr("transform", "translate(" + ((width - cellSize * 53) / 2) + "," + (height - cellSize * 7 - 1) + ")");

svg.append("text")
    .attr("transform", "translate(-6," + cellSize * 3.5 + ")rotate(-90)")
    .style("text-anchor", "middle")
    .text(function(d) { return d; });

var rect = svg.selectAll(".day")
    .data(function(d) { return d3.time.days(new Date(d, 0, 1), new Date(d + 1, 0, 1)); })
	.enter()
	.append("rect")
    .attr("class", "day")
	.attr("id", function(d) { return d;})
    .attr("width", cellSize)
    .attr("height", cellSize)
    .attr("x", function(d) { return week(d) * cellSize; })
    .attr("y", function(d) { return day(d) * cellSize; })
	.on("mouseover", function(d) { 
		//console.log("rect : " + d);
		selectedDateLast = d;
		buildSelectData(d, "day");
	})
	.attr("id", function(d) { var strDate = buildDataview(d, ""); return strDate;})
    .datum(format);
	
rect.append("title")
   .text(function(d) { return d; });
	//.text(function(d) { return this.id; });

svg.selectAll(".month")
    .data(function(d) { return d3.time.months(new Date(d, 0, 1), new Date(d + 1, 0, 1)); })
  .enter().append("path")
    .attr("class", "month")
    .attr("d", monthPath);

	
	var month_name = d3.time.format("%B")

svg.selectAll("text.month")
    .data(function(d) { return d3.time.months(new Date(d, 0, 1), new Date(d + 1, 0, 1)); })
  .enter().append("text")
    .attr("class", "monthTxt")
    .attr("x", function(d) { return week(d) * cellSize+25; })
	.attr("y", -5)
	.attr("transform", "translate(0,0)")
    .attr("style", "text-anchor:left;")
    .text(month_name);
	
var ScaleArr = ["NA", "0" ];
var LScaleArr = ["NA","0"];
var DataArr = [];


rect.filter(function(d) { return d in dataBIG; })
	.attr("class", function(d) { 
							DataArr.push(dataBIG[d]);
							if (dataBIG[d] == 0) 
							{
								//console.log("day N" + color(dataBIG[d]));
								return "day N" + color(dataBIG[d]);
							}
							else 
							{	
							//console.log("day " + color(dataBIG[d]));
							return "day " + color(dataBIG[d]);
							}
							
		})
	.on("mouseover", function(d) { 
		if (dataBIG[d] == 0) 
			{
				//console.log("day N" + color(dataBIG[d]));
				var strClass =  "day N" + color(dataBIG[d]);
			}
		else 
			{	
				//console.log("day " + color(dataBIG[d]));
			var strClass = "day " + color(dataBIG[d]);
			}
		//console.log(dataBIG[d] + " | " + d + "|" + strClass);				
		buildSelectData (d,strClass);
	} )
	.attr("id", function(d) { 
		//console.log("dataBIG-drawCalender"); 
		return d;})
	.select("title")
	.text(function(d) { 
			return d + ": " + addCommas(dataBIG[d]); 
		});

	
var increment  = (d3.max(DataArr) - d3.min(DataArr))/arrayRange;
var Lbound = d3.min(DataArr);
for (var i=1; i<(arrayRange+1); i++)
{
	ScaleArr.push(parseInt(Lbound + i* increment));
	LScaleArr.push(parseInt(Lbound + (i-1)* increment));
	//console.log(ScaleArr.length);
}
ScaleArr[ScaleArr.length-1] = d3.max(DataArr);

buildLegend ();				


////++++++++++++++++++++++++++++++++++++++++
function monthPath(t0) {
  var t1 = new Date(t0.getFullYear(), t0.getMonth() + 1, 0),
      d0 = +day(t0), w0 = +week(t0),
      d1 = +day(t1), w1 = +week(t1);
  return "M" + (w0 + 1) * cellSize + "," + d0 * cellSize
      + "H" + w0 * cellSize + "V" + 7 * cellSize
      + "H" + w1 * cellSize + "V" + (d1 + 1) * cellSize
      + "H" + (w1 + 1) * cellSize + "V" + 0
      + "H" + (w0 + 1) * cellSize + "Z";
}

function buildLegend () {

//console.log(ScaleArr);	
var legend = d3.select(".legendC")
.append("svg")
      .attr("class", "legend")
	  .attr("width", cellSize * 10)
      .attr("height", (cellSize * arrayRange) + 2 * cellSize)
	  .selectAll("g")
	  .data(ScaleArr)
    .enter().append("g")
      .attr("transform", function(d, i) { return "translate(120," + i * 20 + ")"; });
						
legend.append("rect")
      .attr("width", cellSize )
      .attr("height", cellSize )
	  .attr("class" , function(d, i){ 
							var strClass = ""
							//console.log("color(d) : " + color(d) + " | d: " + d + " | i: " + i); 
							if (i>1) 
								strClass = color(d)
							else 
								if ( i ==1 ) strClass = "N" + color(d)
								else strClass = "day"
							return strClass ;})
	.attr("id" , function(d, i){ 
							var strClass = ""
							//console.log("color(d) : " + color(d) + " | d: " + d + " | i: " + i); 
							if (i>1) 
								strClass = color(d)
							else 
								if ( i ==1 ) strClass = "N" + color(d)
								else strClass = "day"
							return strClass ;});
  legend.append("text")
      .attr("x", 24-30)
      .attr("y", 9)
      .attr("dy", ".35em")
	  .attr("text-anchor", "end")
      .text(function(d,i) { 
		//console.log(d);
		//LScaleArr[i]
		var strLbl = ""
		if (i>0) 
			{ 
			//console.log(arrayRange + " | " + i);
			if (i < (arrayRange-1)) 
				{ //console.log("if");
				strLbl =  addCommas(LScaleArr[i]) + " - "+ addCommas(d);
				}
			else 
				{
					//console.log("else");
					strLbl =  addCommas(LScaleArr[i]) + " - "+ addCommas(domainMax);
				}
			}
		else 
			strLbl = "Data not available";
		return strLbl;
			}
		)
}
// -- calendar building ends --//


}

function buildDataview (strDate, Ind) {

//console.log("buildDataview");
//console.log(Ind);
var monthNames = [ "Jan", "Feb", "Mar", "Apr", "May", "Jun",
    "Jul", "Aug", "Sep", "Oct", "Nov", "Dec" ];
	
var d = strDate;
if (d.getDate().toString().length == 1)  var curr_date = "0"+d.getDate();
else var curr_date = d.getDate();

var DCurrMonth = "";
if (Ind == "Display") { 
	DCurrMonth = monthNames[d.getMonth()];
}
else
{
	if (d.getMonth().toString().length == 1) 
	{
	var curr_month = "0"+parseInt(d.getMonth()+1);
	}	
	else 
	{
		var curr_month = d.getMonth()+1; //Months are zero based
	}
}

	
var curr_year = d.getFullYear();
var strDateX = "";
selectedDate = curr_year + "-" + curr_month + "-" + curr_date;
//console.log(selectedDate);
if (Ind == "Display") { 
		strDateX  = DCurrMonth + " " + d.getDate() + " " + curr_year;
	}
else strDateX =  curr_year + "-" + curr_month + "-" + curr_date;
//console.log("strDate")
//console.log(strDateX)
return strDateX;
}

function buildDisplayDate (strDate) {

var monthNames = [ "Jan", "Feb", "Mar", "Apr", "May", "Jun",
    "Jul", "Aug", "Sep", "Oct", "Nov", "Dec" ];
var arrDate = strDate.split("-");

if (arrDate[1].substring(0,1) != "0") 
{	
	//console.log("typeof(arrDate[1]): 2");
	//console.log(typeof(arrDate[1]));
	//console.log(arrDate[1].substring(0,1) );
	var currmonth = monthNames[Number(arrDate[1])-1];
}
else 
{
	//console.log("typeof(arrDate[1]) : 1");
	//console.log(typeof(arrDate[1]));
	//console.log(arrDate[1].substring(0,1) );
	var currmonth = monthNames[Number(arrDate[1].substring(1,2))-1];
}
strDateX  = currmonth + " " + arrDate[2] + " " + arrDate[0];

return strDateX;
}

function buildSelectData (strDt, StrClass) {
	SelectedData = [];
	
	var displayDt = buildDisplayDate(strDt);
	//if (origDt !="") 
	d3.select("#currDate").text(displayDt);
	//else d3.select("#currDate").text(strDt);
	selectedDate = strDt;
	try { document.getElementById(strDt).focus();
	}
	catch(err)
	{}
	//console.log("StrClass");
	//console.log(StrClass);
	var strFile = "";
	var strFileErr = "";

	var errMsgs = [];
	var fileLayout = [];
	
	BIGDATA.forEach(function (d) {
		
		if (strDt == d.Date) 
		{
			if (typeof(d.File_Layouts) == "string") 
			{ 
			var strFilString = d.File_Layouts;
			strCurrFile = strFilString.split("|");
			strCurrFile.forEach (function(d) {
				if (strFile.indexOf(d) == -1 && (d !="") ) strFile = strFile + d + "|";
				});
			}
		if (typeof(d.Error_Msgs) == "string") 
			{ 
			var strErrString = d.Error_Msgs;
			strCurrErr = strErrString.split("|");
			
			for (var i=0;i<strCurrErr.length;i++)
				{
				if (strFileErr.indexOf(strCurrErr[i]) == -1 && (i%2 == 0) ) 
					{
						strFileErr = strFileErr + strCurrErr[i] + "|";
					}
				}
			}
			
			if (typeof(strFileErr) == "string") {
				var arrErr = strFileErr.split("|");
				arrErr.forEach( function(d) {
				if (d != "") errMsgs.push(d);
					})
				}
			if (typeof(strFile) == "string") {
				var arrFileLayout = strFile.split("|");
				arrFileLayout.forEach( function(d) {
				if (d != "") fileLayout.push(d);
					})
				}
			var datarow = {
						"Date" : d.Date,
						"Tot_Records" :  parseInt(d.Tot_Records),
						"Tot_Inserts" : parseInt(d.Tot_Inserts),
						"Tot_Updates" : parseInt(d.Tot_Updates),
						"Tot_Failures" : parseInt(d.Tot_Failures),
						"Tot_Duration_Secs" : Number(d.Tot_Duration_Secs),
						"Tot_Duration_Hrs" : Number(d.Tot_Duration_Hrs),
						"File_Layouts" : fileLayout.length,
						"Error_Msgs" : errMsgs.length,
						"Files" : fileLayout,
						"Errors" : errMsgs
					}
					
			SelectedData.push(datarow);
			
			
		}
	})
	//console.log("SelectedData");
	//console.log(SelectedData);
	//console.log(typeof(BIGDATA));
	//console.log(typeof(SelectedData));
	if (SelectedData.length > 0 ) 
	{
		SelectedData.forEach (function (d) {
				d3.select("#dtot").text(function (x) { return addCommas(d.Tot_Records);});
				d3.select("#derr").text(function (x) { return addCommas(d.Tot_Failures);});
				d3.select("#dupd").text(function (x) { return addCommas(d.Tot_Updates);});
				d3.select("#dnew").text(function (x) { return addCommas(d.Tot_Inserts);});
				d3.select("#ddurH").text(function (x) { return addCommas(d.Tot_Duration_Hrs);});
				d3.select("#dfile").text(function (x) { return addCommas(d.File_Layouts);});
				d3.select("#derrM").text(function (x) { return addCommas(d.Error_Msgs);});
			});
	}
	else
	{
		d3.select("#dtot").text("NA");
		d3.select("#derr").text("NA");
		d3.select("#dupd").text("NA");
		d3.select("#dnew").text("NA");
		d3.select("#ddurH").text("NA");
		d3.select("#dfile").text("NA");
		d3.select("#derrM").text("NA");
		
	}
	//console.log("selectedDateLast:" + selectedDateLast);
	//document.getElementById(selectedDateLast).focus();
	//var idSelect = "#"+selectedDateLast;
	//document.getElementById(selectedDateLast).attr("style", "stroke:red");
	//d3.select("#dtot").text( function(d) {SelectedData[0].Tot_Records;});
}
function buildSummaryData () {
	
	var Summ_Recs = 0;
	var Summ_Err = 0;
	var Summ_Upd = 0;
	var Summ_New = 0;
	var Summ_Load_sec = 0.00;
	var Summ_Load_hr = 0.00;
	var Summ_days = 0;
	var Summ_days_err = 0;
	
	var strFile = "";
	var strFileErr = "";
	SummaryData = [];
	var errMsgs = [];
	var fileLayout = [];
	
	//console.log(BIGDATA);
	BIGDATA.forEach(function (d) {
		if (! isNaN(d.Tot_Records)) Summ_Recs = Summ_Recs + parseInt(d.Tot_Records);
		if (! isNaN(d.Tot_Failures)) Summ_Err = Summ_Err + parseInt(d.Tot_Failures);
		if (! isNaN(d.Tot_Updates)) Summ_Upd = Summ_Upd + parseInt(d.Tot_Updates);
		if (! isNaN(d.Tot_Inserts)) Summ_New = Summ_New + parseInt(d.Tot_Inserts);
		if (! isNaN(d.Tot_Duration_Hrs)) Summ_Load_hr = Summ_Load_hr + d3.round(Number(d.Tot_Duration_Hrs),2);
		if (! isNaN(d.Tot_Duration_Secs)) Summ_Load_sec = Summ_Load_sec + d3.round(Number(d.Tot_Duration_Secs),2);
		
		Summ_days  = Summ_days +1;
		if (d.Tot_Failures > 0) Summ_days_err = Summ_days_err +1;
		
		if (typeof(d.File_Layouts) == "string") 
		{ 
			var strFilString = d.File_Layouts;
			strCurrFile = strFilString.split("|");
			strCurrFile.forEach (function(d) {
				if (strFile.indexOf(d) == -1 && (d !="") ) strFile = strFile + d + "|";
			});
		}
		if (typeof(d.Error_Msgs) == "string") 
		{ 
			var strErrString = d.Error_Msgs;
			strCurrErr = strErrString.split("|");
			
			for (var i=0;i<strCurrErr.length;i++)
			{
				if (strFileErr.indexOf(strCurrErr[i]) == -1 && (i%2 == 0) ) 
					{
						strFileErr = strFileErr + strCurrErr[i] + "|";
					}
			}
		}
	})
	if (typeof(strFileErr) == "string") {
		var arrErr = strFileErr.split("|");
		arrErr.forEach( function(d) {
				if (d != "") errMsgs.push(d);
			})
	}
	if (typeof(strFile) == "string") {
		var arrFileLayout = strFile.split("|");
		arrFileLayout.forEach( function(d) {
				if (d != "") fileLayout.push(d);
			})
	}

	var datarow = {
						"Tot_Records" :  Summ_Recs,
						"Tot_Inserts" : Summ_New,
						"Tot_Updates" : Summ_Upd,
						"Tot_Failures" : Summ_Err,
						"Tot_Duration_Secs" : d3.round(Summ_Load_sec,2),
						"Tot_Duration_Hrs" : d3.round(Summ_Load_hr,2),
						"File_Layouts" : fileLayout.length,
						"Error_Msgs" : errMsgs.length,
						"Tot_days" : Summ_days-1,
						"Tot_Err_days" :Summ_days_err-1,
						"Files" : fileLayout,
						"Errors" : errMsgs
						
						
					}
	SummaryData.push(datarow);
	//console.log(SummaryData);
	if (SummaryData.length > 0 ) 
	{
		SummaryData.forEach (function (d) {
				d3.select("#Sdtot").text(function (x) { return addCommas(d.Tot_Records);});
				d3.select("#Sderr").text(function (x) { return addCommas(d.Tot_Failures);});
				d3.select("#Sdupd").text(function (x) { return addCommas(d.Tot_Updates);});
				d3.select("#Sdnew").text(function (x) { return addCommas(d.Tot_Inserts);});
				d3.select("#SddurH").text(function (x) { return addCommas(d.Tot_Duration_Hrs);});
				d3.select("#Sdfile").text(function (x) { return addCommas(d.File_Layouts);});
				d3.select("#SderrM").text(function (x) { return addCommas(d.Error_Msgs);});
				d3.select("#SderrDAYS").text(function (x) { return addCommas(d.Tot_Err_days);});
				d3.select("#SdDAYS").text(function (x) { return addCommas(d.Tot_days);});
			});
	}
	else
	{
		d3.select("#Sdtot").text("");
		d3.select("#Sderr").text("");
		d3.select("#Sdupd").text("");
		d3.select("#Sdnew").text("");
		d3.select("#SddurH").text("");
		d3.select("#Sdfile").text("");
		d3.select("#SderrM").text("");
		d3.select("#SderrDAYS").text("");
		d3.select("#SdDAYS").text("");
		
	}
}
function addCommas(nStr)
{
	nStr += '';
	x = nStr.split('.');
	x1 = x[0];
	x2 = x.length > 1 ? '.' + x[1] : '';
	var rgx = /(\d+)(\d{3})/;
	while (rgx.test(x1)) {
		x1 = x1.replace(rgx, '$1' + ',' + '$2');
	}
	return x1 + x2;
}
d3.select(self.frameElement).style("height", "2910px");

</script>
